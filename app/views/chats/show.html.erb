<div class="full-chat-wrapper" ng-controller="ChatsController as chat" data-sender="<%= current_user.display_name %>" data-receiver="<%= @other_user.display_name %>" data-thumbnail="<%= current_user.primary_profile_photo_thumb %>" data-room-id="<%= get_room_id(current_user, @other_user) %>" data-contacts="<%= current_user.get_contacts.map(&:id) %>" ng-cloak>
  <div class="chat-header">
    <div class="chat-thumbnail">
      <%= link_to dater_path(@other_user) do %>
        <%= image_tag @other_user.primary_profile_photo_thumb.url %>
      <% end %>
    </div>
    <h4>Chat with <%= link_to @other_user.display_name, dater_path(@other_user) %></h4>
    <h5>{{chat.messages.length}} messages.</h5>
  </div>

  <div class="chat-contents">
    <ul>
      <li class="chat-message" ng-repeat="msg in chat.messages" ng-class="[chat.fromSelf(msg) ? 'mine' : 'theirs']">
        <div class="message-sender">{{msg.sender}}</div>
        <div class="message-time">{{ msg.created_at | date:'h:mma, MMMM d yyyy' }}</div>
        <div class="arrow"></div><div class="chat-message-box pre-wrap">{{msg.message}}</div>
      </li>

      <li class="chat-bottom-spacer"></li>
    </ul>

  </div>

  <div class="chat-send" id="chat-send">
    <form ng-submit="chat.pushMessage()">
      <div class="flex-inputs">
        <div class="textarea-holder">
          <textarea id="chat-message-input" ng-model="chat.current_input" placeholder="Type a message" ng-enter-to-send="chat.hi()"></textarea>
        </div>
        <div class="submit-holder">
          <input type="submit" value="Send" class="interaction-text-button message">
        </div>
      </div>
    </form>
  </div>

  <div class="contact-list-wrapper">
    <h3>Contacts</h3> 
    <ul>
      <li ng-repeat="contact in chat.contacts" ng-class="{selected: contact.$id === chat.receiver}">
        <a ng-href="/chats/{{contact.$id}}">
          <img ng-src="{{contact.thumb}}" alt="">
          <h4>{{contact.display_name}}</h4>
          <p>Last Online: 12 minutes ago</p>
        </a>
      </li>
    </ul>
  </div>
</div>
