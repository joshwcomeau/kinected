<header class="bg-teal">
  <div class="onboard-wrapper">
    <h1>Welcome Aboard!</h1>
    <h3>
      <strong>Congrats!</strong> We've determined that you're an ideal candidate for Kinected.
    </h3>
  </div>
</header>

<div class="onboard-wrapper" ng-controller="UserRegistrationController as user">
  <p class="registration-paragraph">You can register for an account below, we just need some basic information from you. More introductory text goes here, talking about maybe the fee involved, or the perks of signing up?</p>

  <%= form_for(resource, {as: resource_name, url: registration_path(resource_name), html: {name: 'user.registration_form', novalidate: true, "ng-submit" => 'user.validateStep(3, $event)'}}) do |f| %>
    <%= devise_error_messages! %>


    <div class="step-1">
      <h4 class="form-section-heading" data-number="1">Basic Information</h4>
      
      <fieldset>
        <div class="form-row">
          <div class="form-label"><%= f.label :first_name, "Your Name" %></div>
          <div class="form-input">
            <%= f.text_field :first_name, autofocus: true, placeholder: 'First Name', required: true, class: 'half-width-spaced', "ng-model" => 'user.first_name' %><!--  
         --><%= f.text_field :last_name, placeholder: 'Last Name', required: true, class: 'half-width', "ng-model" => 'user.last_name' %>
            <p ng-show="(user.registration_form['user[first_name]'].$invalid || user.registration_form['user[last_name]'].$invalid ) &amp;&amp; user.state_status.step1.submitted" class="help-block">Please enter your first and last name.</p>
          </div> 
        </div>

        <div class="form-row">
          <div class="form-label">Your Birthdate</div>
          <div class="form-input">
            <%= number_field_tag "birthdate_month", nil, class: 'third-width-spaced', placeholder: 'MM', in: 1..12, required: true, "ng-model" => 'user.birthdate.month' %><!--  
         --><%= number_field_tag "birthdate_day", nil, class: 'third-width-spaced', placeholder: 'DD', in: 1..31, required: true, "ng-model" => 'user.birthdate.day' %><!--  
         --><%= number_field_tag "birthdate_year", nil, class: 'third-width', placeholder: 'YYYY', in: 1901..2014, required: true, "ng-model" => 'user.birthdate.year' %>
            <p ng-show="(user.registration_form['birthdate_month'].$invalid || user.registration_form['birthdate_day'].$invalid || user.registration_form['birthdate_year'].$invalid ) &amp;&amp; user.state_status.step1.submitted" class="help-block">Your birthday must be entered in the format MM - DD - YYYY.</p>
          </div>
        </div>

        <div class="form-row">
          <div class="form-label">Your Gender</div>
          <div class="form-input">
            <%= f.radio_button :sex, "male", required: true, "ng-model" => 'user.sex' %><%= f.label :sex_male, "Male", class: 'half-width-spaced sex-select', 'ng-class' => '{selected: user.sex==="male"}' %><!--
         --><%= f.radio_button :sex, "female", required: true, "ng-model" => 'user.sex' %><%= f.label :sex_female, "Female", class: 'half-width sex-select', 'ng-class' => '{selected: user.sex==="female"}' %>
            <p ng-show="user.registration_form['user[sex]'].$invalid &amp;&amp; user.state_status.step1.submitted" class="help-block">Please click/tap on your gender.</p>
          </div> 
        </div>

        <div class="form-row" style="display: none;">
          <%= collection_check_boxes(:user, :ethnicity_ids, Ethnicity.all, :id, :name) %>
        </div>

      </fieldset>
      <div class="next-button-div" ng-show="user.current_step < 2"><%= button_tag "Continue", type: "button", class: 'next-button', "ng-click" => "user.validateStep(1)" %></div>
    </div>

    <div class="step-2" ng-show="user.state_status.step1.submitted &amp;&amp; user.state_status.step1.valid">
      <h4 class="form-section-heading" data-number="2">Upload Profile Photo</h4>
      
      <fieldset>

        <div class="form-photo-cell">
          <div class="image-holder" onclick="$('input[id=photo-object-field]').click();" ng-hide="user.image_src"></div>
          <img ng-src="{{user.image_src}}" ng-show="user.image_src" class="image-upload-preview">
        </div>
        <div class="form-input">
          <p class="no-top-margin">Let's start by uploading your first profile picture. Pictures are mandatory to use the site, you won't be seen or be able to interact with users until you have at least 1!</p>

          <%= f.fields_for :profile_photos do |p| %>

            <%= p.file_field :photo_object, id: 'photo-object-field', class: 'hide', "ng-file-select" => "onFileSelect($files)", "ng-model" => "user.image_src" %>
            <!-- Custom file selector -->
            <a class="upload-photo-button" onclick="$('input[id=photo-object-field]').click();">
              Upload Image
            </a>
          <% end %>

          <p class="small-and-light">If you want, you can skip this part for now.</p>
        </div>

      </fieldset>
      
      <div class="next-button-div" ng-show="user.current_step < 3">
        <%= button_tag "Skip and Continue", type: "button", class: 'next-button', "ng-click" => "user.validateStep(2)" %>
      </div>

    </div>

    <div class="step-3" ng-show="user.state_status.step2.submitted &amp;&amp; user.state_status.step2.valid">
      <h4 class="form-section-heading" data-number="3">Account Information</h4>
      
      <fieldset>
        <div class="form-row">
          <div class="form-label"><%= f.label :email %></div>
          <div class="form-input">
            <%= f.email_field :email, required: true, class: 'full-width', "ng-model" => "user.email" %>
            <p ng-show="user.registration_form['user[email]'].$invalid &amp;&amp; user.state_status.step3.submitted" class="help-block">Please enter a valid email (eg. john@gmail.com).</p>
          </div>
        </div>

        <div class="form-row">
          <div class="form-label"><%= f.label :password %></div>
          <div class="form-input">
            <%= f.password_field :password, required: true, autocomplete: "off", class: 'full-width', "ng-model" => "password", "ng-minlength" => 8, "ng-maxlength" => 30 %>
            <p ng-show="user.registration_form['user[password]'].$invalid &amp;&amp; user.state_status.step3.submitted" class="help-block">Passwords must be at least 8 characters, and no more than 30.</p>
          </div>
        </div>

        <div class="form-row">
          <div class="form-label"><%= f.label :password_confirmation, "Confirm Password" %></div>
          <div class="form-input"><%= f.password_field :password_confirmation, required: true, autocomplete: "off", class: 'full-width', "ng-model" => "password_confirmation", "ng-minlength" => 8, "ng-maxlength" => 30 %>
            <p ng-show="user.mismatched_passwords &amp;&amp; user.state_status.step3.submitted" class="help-block">Please enter the same password again. This is to prevent typos.</p>
          </div>
        </div>

      </fieldset>

      <div class="submit-button-div"><%= f.submit "Register", class: 'submit-button' %></div>

    </div>
    


  <% end %>
</div>
